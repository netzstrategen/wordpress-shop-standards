/* global jQuery, shop_standards_settings */
(function pageLoad($) {
  var _this = this;

  // Toggles product filtering by term.
  $('body').on('click', '.woocommerce-widget-layered-nav-list__item, .widget_layered_nav_filters .chosen, .shop-sidebar-widget .chosen', function (e) {
    var url = $(e.target).data('url');

    if (url) {
      document.location.href = url;
    }
  });
  /**
   * Prevents multiple order to be sent.
   *
   * If the page takes time to be loaded, the user could click multiple
   * times on the place order button and this would generate multiple orders.
   * To prevent this we stop form submit event propagation after the first click.
   */

  var placeOrderBtnInitialValue = $('#place_order').prop('value');
  $('#place_order').click(function disableSubmitOrder(e) {
    if ($(this).hasClass('disabled')) {
      e.preventDefault();
      return;
    }

    $('#place_order').prop('value', 'Ihre Bestellung wird jetzt verarbeitetâ€¦').addClass('disabled');
  });
  $(document.body).on('checkout_error', function () {
    $('#place_order').prop('value', placeOrderBtnInitialValue).removeClass('disabled');
  });
  var $variationsForm = $('.variations_form');
  var $variationsSelectDropdowns = $('.variations_form .variations select');
  var $variationSelectChanged = false;
  $variationsSelectDropdowns.change(function variationSelectDropdownChanged() {
    $variationSelectChanged = $(this);
  });
  $('.variations_form').on('woocommerce_variation_has_changed', function () {
    // Allow selecting the default empty value of an attributes dropdown
    // without modifying the value of the others.
    if ($variationSelectChanged && $variationSelectChanged.val() === '') {
      $variationSelectChanged.val('');
      $variationSelectChanged = false;
    } else {
      // If there is only one option left in any of current variation attributes
      // dropdowns, it should be auto-selected.
      $variationsSelectDropdowns.each(function setVariationSelectDropdowns() {
        var $this = $(this);

        if ($this.find('option').size() === 2) {
          $this.val($this.find('option').eq(1).val());
        }
      });
    } // Ensure the rigth product image is displayed.
    // Some delay seems to be needed to refresh the product image.
    // We couldn't find a proper event to hook on, so we used a timeout.


    setTimeout(function () {
      $variationsForm.trigger('check_variations');
    }, 100);
  });
  $('.single_variation_wrap').on('show_variation', function (event, variation) {
    // Updates discount table on product variation change.
    $('[data-variations]').parent().hide();
    $($('[data-variations]')).each(function updateDiscountTable() {
      if ($(this).data('variations').indexOf(variation.variation_id.toString()) !== -1) {
        $(this).parent().show();
      }
    });
  }).on('hide_variation', function () {
    // Hides all variation product discount table on product variation hide.
    $($('[data-variations]')).each(function hideDiscountTable() {
      $(this).parent().hide();
    });
  });
  $(document).ready(function () {
    // Disable copy/paste actions on billing email fields.
    if (shop_standards_settings.emailConfirmationEmail === 'yes') {
      $('#billing_email, #billing_email_confirmation').each(function () {
        // eslint-disable-next-line max-nested-callbacks
        $(_this).on('cut copy paste', function (e) {
          e.preventDefault();
        });
      }); // Marks email confirmation field as invalid if does not match email
      // field on form submit.

      $('form.woocommerce-checkout').on('input validate change', function () {
        if ($('#billing_email').val() !== $('#billing_email_confirmation').val()) {
          $('#billing_email_confirmation_field').removeClass('woocommerce-validated').addClass('woocommerce-invalid woocommerce-invalid-required-field');
        }
      });
    }

    $('form.woocommerce-checkout').on('input', '#billing_salutation, #shipping_salutation, #woocommerce_eu_vat_number', function (e) {
      var billingSalutation = $('#billing_salutation').val();
      var shippingSalutation = $('#shipping_salutation').val();
      var billingVat = $('#woocommerce_eu_vat_number');

      if (billingSalutation === 'Company' && billingVat.val() && shippingSalutation !== billingSalutation) {
        $('#shipping_salutation').val($('#billing_salutation').val()).css('pointer-events', 'none').trigger('change');
        $('#shipping_salutation option:not(:selected)').prop('disabled', true);
      } else if (e.target.name === 'billing_salutation' && billingVat.val()) {
        $('#shipping_salutation').css('pointer-events', 'initial');
        $('#shipping_salutation option:not(:selected)').prop('disabled', false);
        billingVat.val('');
      }

      if (e.target.name.indexOf('salutation') !== -1) {
        $(document.body).trigger('update_checkout');
      }
    });
  }); // Disable checkout button if there are any WooCommerce error displayed.

  $(document).on('ready updated_cart_totals', function () {
    if ($('.woocommerce-error').length) {
      $('.checkout-button').removeAttr('href').addClass('disabled');
      $('.wcppec-checkout-buttons').hide();
    }
  });
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicGFnZUxvYWQiLCIkIiwib24iLCJlIiwidXJsIiwidGFyZ2V0IiwiZGF0YSIsImRvY3VtZW50IiwibG9jYXRpb24iLCJocmVmIiwicGxhY2VPcmRlckJ0bkluaXRpYWxWYWx1ZSIsInByb3AiLCJjbGljayIsImRpc2FibGVTdWJtaXRPcmRlciIsImhhc0NsYXNzIiwicHJldmVudERlZmF1bHQiLCJhZGRDbGFzcyIsImJvZHkiLCJyZW1vdmVDbGFzcyIsIiR2YXJpYXRpb25zRm9ybSIsIiR2YXJpYXRpb25zU2VsZWN0RHJvcGRvd25zIiwiJHZhcmlhdGlvblNlbGVjdENoYW5nZWQiLCJjaGFuZ2UiLCJ2YXJpYXRpb25TZWxlY3REcm9wZG93bkNoYW5nZWQiLCJ2YWwiLCJlYWNoIiwic2V0VmFyaWF0aW9uU2VsZWN0RHJvcGRvd25zIiwiJHRoaXMiLCJmaW5kIiwic2l6ZSIsImVxIiwic2V0VGltZW91dCIsInRyaWdnZXIiLCJldmVudCIsInZhcmlhdGlvbiIsInBhcmVudCIsImhpZGUiLCJ1cGRhdGVEaXNjb3VudFRhYmxlIiwiaW5kZXhPZiIsInZhcmlhdGlvbl9pZCIsInRvU3RyaW5nIiwic2hvdyIsImhpZGVEaXNjb3VudFRhYmxlIiwicmVhZHkiLCJzaG9wX3N0YW5kYXJkc19zZXR0aW5ncyIsImVtYWlsQ29uZmlybWF0aW9uRW1haWwiLCJiaWxsaW5nU2FsdXRhdGlvbiIsInNoaXBwaW5nU2FsdXRhdGlvbiIsImJpbGxpbmdWYXQiLCJjc3MiLCJuYW1lIiwibGVuZ3RoIiwicmVtb3ZlQXR0ciIsImpRdWVyeSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFFQyxVQUFTQSxRQUFULENBQWtCQyxDQUFsQixFQUFxQjtBQUFBOztBQUNwQjtBQUNBQSxFQUFBQSxDQUFDLENBQUMsTUFBRCxDQUFELENBQ0dDLEVBREgsQ0FFSSxPQUZKLEVBR0ksK0dBSEosRUFJSSxVQUFDQyxDQUFELEVBQU87QUFDTCxRQUFNQyxHQUFHLEdBQUdI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OUMsRUFBZ0U7QUFDckV2QixRQUFBQSxDQUFDLENBQUMsc0JBQUQsQ0FBRCxDQUEwQmdELEdBQTFCLENBQThCLGdCQUE5QixFQUFnRCxTQUFoRDtBQUNBaEQsUUFBQUEsQ0FBQyxDQUFDLDRDQUFELENBQUQsQ0FBZ0RVLElBQWhELENBQXFELFVBQXJELEVBQWlFLEtBQWpFO0FBQ0FxQyxRQUFBQSxVQUFVLENBQUN4QixHQUFYLENBQWUsRUFBZjtBQUNEOztBQUNELFVBQUlyQixDQUFDLENBQUNFLE1BQUYsQ0FBUzZDLElBQVQsQ0FBY1osT0FBZCxDQUFzQixZQUF0QixNQUF3QyxDQUFDLENBQTdDLEVBQWdEO0FBQzlDckMsUUFBQUEsQ0FBQyxDQUFDTSxRQUFRLENBQUNVLElBQVYsQ0FBRCxDQUFpQmUsT0FBakIsQ0FBeUIsaUJBQXpCO0FBQ0Q7QUFDRixLQWxCRDtBQW1CRCxHQXJDRCxFQW5Gb0IsQ0EwSHBCOztBQUNBL0IsRUFBQUEsQ0FBQyxDQUFDTSxRQUFELENBQUQsQ0FBWUwsRUFBWixDQUFlLDJCQUFmLEVBQTRDLFlBQU07QUFDaEQsUUFBSUQsQ0FBQyxDQUFDLG9CQUFELENBQUQsQ0FBd0JrRCxNQUE1QixFQUFvQztBQUNsQ2xELE1BQUFBLENBQUMsQ0FBQyxrQkFBRCxDQUFELENBQXNCbUQsVUFBdEIsQ0FBaUMsTUFBakMsRUFBeUNwQyxRQUF6QyxDQUFrRCxVQUFsRDtBQUNBZixNQUFBQSxDQUFDLENBQUMsMEJBQUQsQ0FBRCxDQUE4Qm1DLElBQTlCO0FBQ0Q7QUFDRixHQUxEO0FBTUQsQ0FqSUEsRUFpSUNpQixNQWpJRCxDQUFEIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGpRdWVyeSwgc2hvcF9zdGFuZGFyZHNfc2V0dGluZ3MgKi9cblxuKGZ1bmN0aW9uIHBhZ2VMb2FkKCQpIHtcbiAgLy8gVG9nZ2xlcyBwcm9kdWN0IGZpbHRlcmluZyBieSB0ZXJtLlxuICAkKCdib2R5JylcbiAgICAub24oXG4gICAgICAnY2xpY2snLFxuICAgICAgJy53b29jb21tZXJjZS13aWRnZXQtbGF5ZXJlZC1uYXYtbGlzdF9faXRlbSwgLndpZGdldF9sYXllcmVkX25hdl9maWx0ZXJzIC5jaG9zZW4sIC5zaG9wLXNpZGViYXItd2lkZ2V0IC5jaG9zZW4nLFxuICAgICAgKGUpID0+IHtcbiAgICAgICAgY29uc3QgdXJsID0gJChlLnRhcmdldCkuZGF0YSgndXJsJyk7XG4gICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gdXJsO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICk7XG5cbiAgLyoqXG4gICAqIFByZXZlbnRzIG11bHRpcGxlIG9yZGVyIHRvIGJlIHNlbnQuXG4gICAqXG4gICAqIElmIHRoZSBwYWdlIHRha2VzIHRpbWUgdG8gYmUgbG9hZGVkLCB0aGUgdXNlciBjb3VsZCBjbGljayBtdWx0aXBsZVxuICAgKiB0aW1lcyBvbiB0aGUgcGxhY2Ugb3JkZXIgYnV0dG9uIGFuZCB0aGlzIHdvdWxkIGdlbmVyYXRlIG11bHRpcGxlIG9yZGVycy5cbiAgICogVG8gcHJldmVudCB0aGlzIHdlIHN0b3AgZm9ybSBzdWJtaXQgZXZlbnQgcHJvcGFnYXRpb24gYWZ0ZXIgdGhlIGZpcnN0IGNsaWNrLlxuICAgKi9cblxuICBjb25zdCBwbGFjZU9yZGVyQnRuSW5pdGlhbFZhbHVlID0gJCgnI3BsYWNlX29yZGVyJykucHJvcCgndmFsdWUnKTtcbiAgJCgnI3BsYWNlX29yZGVyJykuY2xpY2soZnVuY3Rpb24gZGlzYWJsZVN1Ym1pdE9yZGVyKGUpIHtcbiAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnZGlzYWJsZWQnKSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAkKCcjcGxhY2Vfb3JkZXInKS5wcm9wKCd2YWx1ZScsICdJaHJlIEJlc3RlbGx1bmcgd2lyZCBqZXR6dCB2ZXJhcmJlaXRldOKApicpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICB9KTtcbiAgJChkb2N1bWVudC5ib2R5KS5vbignY2hlY2tvdXRfZXJyb3InLCAoKSA9PiB7XG4gICAgJCgnI3BsYWNlX29yZGVyJykucHJvcCgndmFsdWUnLCBwbGFjZU9yZGVyQnRuSW5pdGlhbFZhbHVlKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgfSk7XG5cbiAgY29uc3QgJHZhcmlhdGlvbnNGb3JtID0gJCgnLnZhcmlhdGlvbnNfZm9ybScpO1xuICBjb25zdCAkdmFyaWF0aW9uc1NlbGVjdERyb3Bkb3ducyA9ICQoJy52YXJpYXRpb25zX2Zvcm0gLnZhcmlhdGlvbnMgc2VsZWN0Jyk7XG4gIGxldCAkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZCA9IGZhbHNlO1xuXG4gICR2YXJpYXRpb25zU2VsZWN0RHJvcGRvd25zLmNoYW5nZShmdW5jdGlvbiB2YXJpYXRpb25TZWxlY3REcm9wZG93bkNoYW5nZWQoKSB7XG4gICAgJHZhcmlhdGlvblNlbGVjdENoYW5nZWQgPSAkKHRoaXMpO1xuICB9KTtcblxuICAkKCcudmFyaWF0aW9uc19mb3JtJykub24oJ3dvb2NvbW1lcmNlX3ZhcmlhdGlvbl9oYXNfY2hhbmdlZCcsICgpID0+IHtcbiAgICAvLyBBbGxvdyBzZWxlY3RpbmcgdGhlIGRlZmF1bHQgZW1wdHkgdmFsdWUgb2YgYW4gYXR0cmlidXRlcyBkcm9wZG93blxuICAgIC8vIHdpdGhvdXQgbW9kaWZ5aW5nIHRoZSB2YWx1ZSBvZiB0aGUgb3RoZXJzLlxuICAgIGlmICgkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZCAmJiAkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZC52YWwoKSA9PT0gJycpIHtcbiAgICAgICR2YXJpYXRpb25TZWxlY3RDaGFuZ2VkLnZhbCgnJyk7XG4gICAgICAkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZCA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJZiB0aGVyZSBpcyBvbmx5IG9uZSBvcHRpb24gbGVmdCBpbiBhbnkgb2YgY3VycmVudCB2YXJpYXRpb24gYXR0cmlidXRlc1xuICAgICAgLy8gZHJvcGRvd25zLCBpdCBzaG91bGQgYmUgYXV0by1zZWxlY3RlZC5cbiAgICAgICR2YXJpYXRpb25zU2VsZWN0RHJvcGRvd25zLmVhY2goZnVuY3Rpb24gc2V0VmFyaWF0aW9uU2VsZWN0RHJvcGRvd25zKCkge1xuICAgICAgICBjb25zdCAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgIGlmICgkdGhpcy5maW5kKCdvcHRpb24nKS5zaXplKCkgPT09IDIpIHtcbiAgICAgICAgICAkdGhpcy52YWwoJHRoaXMuZmluZCgnb3B0aW9uJykuZXEoMSkudmFsKCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gRW5zdXJlIHRoZSByaWd0aCBwcm9kdWN0IGltYWdlIGlzIGRpc3BsYXllZC5cbiAgICAvLyBTb21lIGRlbGF5IHNlZW1zIHRvIGJlIG5lZWRlZCB0byByZWZyZXNoIHRoZSBwcm9kdWN0IGltYWdlLlxuICAgIC8vIFdlIGNvdWxkbid0IGZpbmQgYSBwcm9wZXIgZXZlbnQgdG8gaG9vayBvbiwgc28gd2UgdXNlZCBhIHRpbWVvdXQuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAkdmFyaWF0aW9uc0Zvcm0udHJpZ2dlcignY2hlY2tfdmFyaWF0aW9ucycpO1xuICAgIH0sIDEwMCk7XG4gIH0pO1xuXG4gICQoJy5zaW5nbGVfdmFyaWF0aW9uX3dyYXAnKVxuICAgIC5vbignc2hvd192YXJpYXRpb24nLCAoZXZlbnQsIHZhcmlhdGlvbikgPT4ge1xuICAgICAgLy8gVXBkYXRlcyBkaXNjb3VudCB0YWJsZSBvbiBwcm9kdWN0IHZhcmlhdGlvbiBjaGFuZ2UuXG4gICAgICAkKCdbZGF0YS12YXJpYXRpb25zXScpLnBhcmVudCgpLmhpZGUoKTtcbiAgICAgICQoJCgnW2RhdGEtdmFyaWF0aW9uc10nKSkuZWFjaChmdW5jdGlvbiB1cGRhdGVEaXNjb3VudFRhYmxlKCkge1xuICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKCd2YXJpYXRpb25zJykuaW5kZXhPZih2YXJpYXRpb24udmFyaWF0aW9uX2lkLnRvU3RyaW5nKCkpICE9PSAtMSkge1xuICAgICAgICAgICQodGhpcykucGFyZW50KCkuc2hvdygpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KVxuICAgIC5vbignaGlkZV92YXJpYXRpb24nLCAoKSA9PiB7XG4gICAgICAvLyBIaWRlcyBhbGwgdmFyaWF0aW9uIHByb2R1Y3QgZGlzY291bnQgdGFibGUgb24gcHJvZHVjdCB2YXJpYXRpb24gaGlkZS5cbiAgICAgICQoJCgnW2RhdGEtdmFyaWF0aW9uc10nKSkuZWFjaChmdW5jdGlvbiBoaWRlRGlzY291bnRUYWJsZSgpIHtcbiAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAkKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgLy8gRGlzYWJsZSBjb3B5L3Bhc3RlIGFjdGlvbnMgb24gYmlsbGluZyBlbWFpbCBmaWVsZHMuXG4gICAgaWYgKHNob3Bfc3RhbmRhcmRzX3NldHRpbmdzLmVtYWlsQ29uZmlybWF0aW9uRW1haWwgPT09ICd5ZXMnKSB7XG4gICAgICAkKCcjYmlsbGluZ19lbWFpbCwgI2JpbGxpbmdfZW1haWxfY29uZmlybWF0aW9uJykuZWFjaCgoKSA9PiB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtbmVzdGVkLWNhbGxiYWNrc1xuICAgICAgICAkKHRoaXMpLm9uKCdjdXQgY29weSBwYXN0ZScsIChlKSA9PiB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBNYXJrcyBlbWFpbCBjb25maXJtYXRpb24gZmllbGQgYXMgaW52YWxpZCBpZiBkb2VzIG5vdCBtYXRjaCBlbWFpbFxuICAgICAgLy8gZmllbGQgb24gZm9ybSBzdWJtaXQuXG4gICAgICAkKCdmb3JtLndvb2NvbW1lcmNlLWNoZWNrb3V0Jykub24oJ2lucHV0IHZhbGlkYXRlIGNoYW5nZScsICgpID0+IHtcbiAgICAgICAgaWYgKCQoJyNiaWxsaW5nX2VtYWlsJykudmFsKCkgIT09ICQoJyNiaWxsaW5nX2VtYWlsX2NvbmZpcm1hdGlvbicpLnZhbCgpKSB7XG4gICAgICAgICAgJCgnI2JpbGxpbmdfZW1haWxfY29uZmlybWF0aW9uX2ZpZWxkJykucmVtb3ZlQ2xhc3MoJ3dvb2NvbW1lcmNlLXZhbGlkYXRlZCcpLmFkZENsYXNzKCd3b29jb21tZXJjZS1pbnZhbGlkIHdvb2NvbW1lcmNlLWludmFsaWQtcmVxdWlyZWQtZmllbGQnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgICQoJ2Zvcm0ud29vY29tbWVyY2UtY2hlY2tvdXQnKS5vbignaW5wdXQnLCAnI2JpbGxpbmdfc2FsdXRhdGlvbiwgI3NoaXBwaW5nX3NhbHV0YXRpb24sICN3b29jb21tZXJjZV9ldV92YXRfbnVtYmVyJywgKGUpID0+IHtcbiAgICAgIGNvbnN0IGJpbGxpbmdTYWx1dGF0aW9uID0gJCgnI2JpbGxpbmdfc2FsdXRhdGlvbicpLnZhbCgpO1xuICAgICAgY29uc3Qgc2hpcHBpbmdTYWx1dGF0aW9uID0gJCgnI3NoaXBwaW5nX3NhbHV0YXRpb24nKS52YWwoKTtcbiAgICAgIGNvbnN0IGJpbGxpbmdWYXQgPSAkKCcjd29vY29tbWVyY2VfZXVfdmF0X251bWJlcicpO1xuICAgICAgaWYgKGJpbGxpbmdTYWx1dGF0aW9uID09PSAnQ29tcGFueScgJiYgYmlsbGluZ1ZhdC52YWwoKSAmJiBzaGlwcGluZ1NhbHV0YXRpb24gIT09IGJpbGxpbmdTYWx1dGF0aW9uKSB7XG4gICAgICAgICQoJyNzaGlwcGluZ19zYWx1dGF0aW9uJylcbiAgICAgICAgICAudmFsKCQoJyNiaWxsaW5nX3NhbHV0YXRpb24nKS52YWwoKSlcbiAgICAgICAgICAuY3NzKCdwb2ludGVyLWV2ZW50cycsICdub25lJylcbiAgICAgICAgICAudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgICAgICQoJyNzaGlwcGluZ19zYWx1dGF0aW9uIG9wdGlvbjpub3QoOnNlbGVjdGVkKScpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICB9IGVsc2UgaWYgKGUudGFyZ2V0Lm5hbWUgPT09ICdiaWxsaW5nX3NhbHV0YXRpb24nICYmIGJpbGxpbmdWYXQudmFsKCkpIHtcbiAgICAgICAgJCgnI3NoaXBwaW5nX3NhbHV0YXRpb24nKS5jc3MoJ3BvaW50ZXItZXZlbnRzJywgJ2luaXRpYWwnKTtcbiAgICAgICAgJCgnI3NoaXBwaW5nX3NhbHV0YXRpb24gb3B0aW9uOm5vdCg6c2VsZWN0ZWQpJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgIGJpbGxpbmdWYXQudmFsKCcnKTtcbiAgICAgIH1cbiAgICAgIGlmIChlLnRhcmdldC5uYW1lLmluZGV4T2YoJ3NhbHV0YXRpb24nKSAhPT0gLTEpIHtcbiAgICAgICAgJChkb2N1bWVudC5ib2R5KS50cmlnZ2VyKCd1cGRhdGVfY2hlY2tvdXQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gRGlzYWJsZSBjaGVja291dCBidXR0b24gaWYgdGhlcmUgYXJlIGFueSBXb29Db21tZXJjZSBlcnJvciBkaXNwbGF5ZWQuXG4gICQoZG9jdW1lbnQpLm9uKCdyZWFkeSB1cGRhdGVkX2NhcnRfdG90YWxzJywgKCkgPT4ge1xuICAgIGlmICgkKCcud29vY29tbWVyY2UtZXJyb3InKS5sZW5ndGgpIHtcbiAgICAgICQoJy5jaGVja291dC1idXR0b24nKS5yZW1vdmVBdHRyKCdocmVmJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAkKCcud2NwcGVjLWNoZWNrb3V0LWJ1dHRvbnMnKS5oaWRlKCk7XG4gICAgfVxuICB9KTtcbn0oalF1ZXJ5KSk7XG4iXSwiZmlsZSI6Im1haW4uanMifQ==
/* global jQuery, shop_standards_settings */
(function pageLoad($) {
  // Toggles product filtering by term.
  $('body').on('click', '[data-url]', function (e) {
    var url = $(e.target).data('url') || $(e.target).closest('[data-url]').data('url');

    if (url) {
      document.location.href = url;
    }
  });
  /**
   * Prevents multiple order to be sent.
   *
   * If the page takes time to be loaded, the user could click multiple
   * times on the place order button and this would generate multiple orders.
   * To prevent this we stop form submit event propagation after the first click.
   */

  var placeOrderBtnInitialValue = $('#place_order').prop('value');
  $('#place_order').click(function disableSubmitOrder(e) {
    if ($(this).hasClass('disabled')) {
      e.preventDefault();
      return;
    }

    $('#place_order').prop('value', 'Ihre Bestellung wird jetzt verarbeitetâ€¦').addClass('disabled');
  });
  $(document.body).on('checkout_error', function () {
    $('#place_order').prop('value', placeOrderBtnInitialValue).removeClass('disabled');
  });
  var $variationsForm = $('.variations_form');
  var $variationsSelectDropdowns = $('.variations_form .variations select');
  var $variationSelectChanged = false;
  $variationsSelectDropdowns.change(function variationSelectDropdownChanged() {
    $variationSelectChanged = $(this);
  });
  $('.variations_form').on('woocommerce_variation_has_changed', function () {
    // Allow selecting the default empty value of an attributes dropdown
    // without modifying the value of the others.
    if ($variationSelectChanged && $variationSelectChanged.val() === '') {
      $variationSelectChanged.val('');
      $variationSelectChanged = false;
    } else {
      // If there is only one option left in any of current variation attributes
      // dropdowns, it should be auto-selected.
      $variationsSelectDropdowns.each(function setVariationSelectDropdowns() {
        var $this = $(this);

        if ($this.find('option').size() === 2) {
          $this.val($this.find('option').eq(1).val());
        }
      });
    } // Ensure the rigth product image is displayed.
    // Some delay seems to be needed to refresh the product image.
    // We couldn't find a proper event to hook on, so we used a timeout.


    setTimeout(function () {
      $variationsForm.trigger('check_variations');
    }, 100);
  });
  $('.single_variation_wrap').on('show_variation', function (event, variation) {
    // Updates discount table on product variation change.
    $('[data-variations]').parent().hide();
    $($('[data-variations]')).each(function updateDiscountTable() {
      if ($(this).data('variations').indexOf(variation.variation_id.toString()) !== -1) {
        $(this).parent().show();
      }
    });
  }).on('hide_variation', function () {
    // Hides all variation product discount table on product variation hide.
    $($('[data-variations]')).each(function hideDiscountTable() {
      $(this).parent().hide();
    });
  });
  $(document).ready(function () {
    // Disable copy/paste actions on billing email fields.
    if (shop_standards_settings.emailConfirmationEmail === 'yes') {
      $('#billing_email, #billing_email_confirmation').on('cut copy paste', function (e) {
        e.preventDefault();
      }); // Marks email confirmation field as invalid if does not match email
      // field on form submit.

      $('form.woocommerce-checkout').on('input validate change', function () {
        if ($('#billing_email').val() !== $('#billing_email_confirmation').val()) {
          $('#billing_email_confirmation_field').removeClass('woocommerce-validated').addClass('woocommerce-invalid woocommerce-invalid-required-field');
        }
      });
    }
  }); // Disable checkout button if there are any WooCommerce error displayed.

  $(document).on('ready updated_cart_totals', function () {
    if ($('.woocommerce-error').length) {
      $('.checkout-button').removeAttr('href').addClass('disabled');
      $('.wcppec-checkout-buttons').hide();
    }
  }); // Used and defective goods checkbox agreement related functionality.

  $(document).ready(function () {
    var $usedGoodsConsentCheckbox = $('#used-goods-consent');
    var $usedGoodsConsentContainer = $('.product-defects__checkbox-container');

    if ($usedGoodsConsentCheckbox.length) {
      $(document).on('show_variation', '.single_variation_wrap', function (event, variation) {
        console.log(variation);
        var usedGoodsConsentAttr = variation.used_goods_consent_attribute;
        $('.product-defects__attribute').text(usedGoodsConsentAttr);

        if (usedGoodsConsentAttr) {
          $usedGoodsConsentContainer.show();
          $usedGoodsConsentCheckbox.prop('required', 'required');
        } else {
          $usedGoodsConsentContainer.hide();
          $usedGoodsConsentCheckbox.removeAttr('required');
        }
      });
    }
  });
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicGFnZUxvYWQiLCIkIiwib24iLCJlIiwidXJsIiwidGFyZ2V0IiwiZGF0YSIsImNsb3Nlc3QiLCJkb2N1bWVudCIsImxvY2F0aW9uIiwiaHJlZiIsInBsYWNlT3JkZXJCdG5Jbml0aWFsVmFsdWUiLCJwcm9wIiwiY2xpY2siLCJkaXNhYmxlU3VibWl0T3JkZXIiLCJoYXNDbGFzcyIsInByZXZlbnREZWZhdWx0IiwiYWRkQ2xhc3MiLCJib2R5IiwicmVtb3ZlQ2xhc3MiLCIkdmFyaWF0aW9uc0Zvcm0iLCIkdmFyaWF0aW9uc1NlbGVjdERyb3Bkb3ducyIsIiR2YXJpYXRpb25TZWxlY3RDaGFuZ2VkIiwiY2hhbmdlIiwidmFyaWF0aW9uU2VsZWN0RHJvcGRvd25DaGFuZ2VkIiwidmFsIiwiZWFjaCIsInNldFZhcmlhdGlvblNlbGVjdERyb3Bkb3ducyIsIiR0aGlzIiwiZmluZCIsInNpemUiLCJlcSIsInNldFRpbWVvdXQiLCJ0cmlnZ2VyIiwiZXZlbnQiLCJ2YXJpYXRpb24iLCJwYXJlbnQiLCJoaWRlIiwidXBkYXRlRGlzY291bnRUYWJsZSIsImluZGV4T2YiLCJ2YXJpYXRpb25faWQiLCJ0b1N0cmluZyIsInNob3ciLCJoaWRlRGlzY291bnRUYWJsZSIsInJlYWR5Iiwic2hvcF9zdGFuZGFyZHNfc2V0dGluZ3MiLCJlbWFpbENvbmZpcm1hdGlvbkVtYWlsIiwibGVuZ3RoIiwicmVtb3ZlQXR0ciIsIiR1c2VkR29vZHNDb25zZW50Q2hlY2tib3giLCIkdXNlZEdvb2RzQ29uc2VudENvbnRhaW5lciIsImNvbnNvbGUiLCJsb2ciLCJ1c2VkR29vZHNDb25zZW50QXR0ciIsInVzZWRfZ29vZHNfY29uc2VudF9hdHRyaWJ1dGUiLCJ0ZXh0IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUVDLFVBQVNBLFFBQVQsQ0FBa0JDLENBQWxCLEVBQXFCO0FBQ3BCO0FBQ0FBLEVBQUFBLENBQUMsQ0FBQyxNQUFELENBQUQsQ0FD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QVFDLFNBQVIsRUFBc0I7QUFDcEVnQixRQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWWpCLFNBQVo7QUFDQSxZQUFNa0Isb0JBQW9CLEdBQUdsQixTQUFTLENBQUNtQiw0QkFBdkM7QUFDQXJELFFBQUFBLENBQUMsQ0FBQyw2QkFBRCxDQUFELENBQWlDc0QsSUFBakMsQ0FBc0NGLG9CQUF0Qzs7QUFDQSxZQUFJQSxvQkFBSixFQUEwQjtBQUN4QkgsVUFBQUEsMEJBQTBCLENBQUNSLElBQTNCO0FBQ0FPLFVBQUFBLHlCQUF5QixDQUFDckMsSUFBMUIsQ0FBK0IsVUFBL0IsRUFBMkMsVUFBM0M7QUFDRCxTQUhELE1BR087QUFDTHNDLFVBQUFBLDBCQUEwQixDQUFDYixJQUEzQjtBQUNBWSxVQUFBQSx5QkFBeUIsQ0FBQ0QsVUFBMUIsQ0FBcUMsVUFBckM7QUFDRDtBQUNGLE9BWkg7QUFhRDtBQUNGLEdBbEJEO0FBbUJELENBaElBLEVBZ0lDUSxNQWhJRCxDQUFEIiwic291cmNlc0NvbnRlbnQiOlsiLyogZ2xvYmFsIGpRdWVyeSwgc2hvcF9zdGFuZGFyZHNfc2V0dGluZ3MgKi9cblxuKGZ1bmN0aW9uIHBhZ2VMb2FkKCQpIHtcbiAgLy8gVG9nZ2xlcyBwcm9kdWN0IGZpbHRlcmluZyBieSB0ZXJtLlxuICAkKCdib2R5JylcbiAgICAub24oXG4gICAgICAnY2xpY2snLFxuICAgICAgJ1tkYXRhLXVybF0nLFxuICAgICAgKGUpID0+IHtcbiAgICAgICAgY29uc3QgdXJsID0gJChlLnRhcmdldCkuZGF0YSgndXJsJykgfHwgJChlLnRhcmdldCkuY2xvc2VzdCgnW2RhdGEtdXJsXScpLmRhdGEoJ3VybCcpO1xuICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgZG9jdW1lbnQubG9jYXRpb24uaHJlZiA9IHVybDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICApO1xuXG4gIC8qKlxuICAgKiBQcmV2ZW50cyBtdWx0aXBsZSBvcmRlciB0byBiZSBzZW50LlxuICAgKlxuICAgKiBJZiB0aGUgcGFnZSB0YWtlcyB0aW1lIHRvIGJlIGxvYWRlZCwgdGhlIHVzZXIgY291bGQgY2xpY2sgbXVsdGlwbGVcbiAgICogdGltZXMgb24gdGhlIHBsYWNlIG9yZGVyIGJ1dHRvbiBhbmQgdGhpcyB3b3VsZCBnZW5lcmF0ZSBtdWx0aXBsZSBvcmRlcnMuXG4gICAqIFRvIHByZXZlbnQgdGhpcyB3ZSBzdG9wIGZvcm0gc3VibWl0IGV2ZW50IHByb3BhZ2F0aW9uIGFmdGVyIHRoZSBmaXJzdCBjbGljay5cbiAgICovXG5cbiAgY29uc3QgcGxhY2VPcmRlckJ0bkluaXRpYWxWYWx1ZSA9ICQoJyNwbGFjZV9vcmRlcicpLnByb3AoJ3ZhbHVlJyk7XG4gICQoJyNwbGFjZV9vcmRlcicpLmNsaWNrKGZ1bmN0aW9uIGRpc2FibGVTdWJtaXRPcmRlcihlKSB7XG4gICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2Rpc2FibGVkJykpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgJCgnI3BsYWNlX29yZGVyJykucHJvcCgndmFsdWUnLCAnSWhyZSBCZXN0ZWxsdW5nIHdpcmQgamV0enQgdmVyYXJiZWl0ZXTigKYnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgfSk7XG4gICQoZG9jdW1lbnQuYm9keSkub24oJ2NoZWNrb3V0X2Vycm9yJywgKCkgPT4ge1xuICAgICQoJyNwbGFjZV9vcmRlcicpLnByb3AoJ3ZhbHVlJywgcGxhY2VPcmRlckJ0bkluaXRpYWxWYWx1ZSkucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gIH0pO1xuXG4gIGNvbnN0ICR2YXJpYXRpb25zRm9ybSA9ICQoJy52YXJpYXRpb25zX2Zvcm0nKTtcbiAgY29uc3QgJHZhcmlhdGlvbnNTZWxlY3REcm9wZG93bnMgPSAkKCcudmFyaWF0aW9uc19mb3JtIC52YXJpYXRpb25zIHNlbGVjdCcpO1xuICBsZXQgJHZhcmlhdGlvblNlbGVjdENoYW5nZWQgPSBmYWxzZTtcblxuICAkdmFyaWF0aW9uc1NlbGVjdERyb3Bkb3ducy5jaGFuZ2UoZnVuY3Rpb24gdmFyaWF0aW9uU2VsZWN0RHJvcGRvd25DaGFuZ2VkKCkge1xuICAgICR2YXJpYXRpb25TZWxlY3RDaGFuZ2VkID0gJCh0aGlzKTtcbiAgfSk7XG5cbiAgJCgnLnZhcmlhdGlvbnNfZm9ybScpLm9uKCd3b29jb21tZXJjZV92YXJpYXRpb25faGFzX2NoYW5nZWQnLCAoKSA9PiB7XG4gICAgLy8gQWxsb3cgc2VsZWN0aW5nIHRoZSBkZWZhdWx0IGVtcHR5IHZhbHVlIG9mIGFuIGF0dHJpYnV0ZXMgZHJvcGRvd25cbiAgICAvLyB3aXRob3V0IG1vZGlmeWluZyB0aGUgdmFsdWUgb2YgdGhlIG90aGVycy5cbiAgICBpZiAoJHZhcmlhdGlvblNlbGVjdENoYW5nZWQgJiYgJHZhcmlhdGlvblNlbGVjdENoYW5nZWQudmFsKCkgPT09ICcnKSB7XG4gICAgICAkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZC52YWwoJycpO1xuICAgICAgJHZhcmlhdGlvblNlbGVjdENoYW5nZWQgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgdGhlcmUgaXMgb25seSBvbmUgb3B0aW9uIGxlZnQgaW4gYW55IG9mIGN1cnJlbnQgdmFyaWF0aW9uIGF0dHJpYnV0ZXNcbiAgICAgIC8vIGRyb3Bkb3ducywgaXQgc2hvdWxkIGJlIGF1dG8tc2VsZWN0ZWQuXG4gICAgICAkdmFyaWF0aW9uc1NlbGVjdERyb3Bkb3ducy5lYWNoKGZ1bmN0aW9uIHNldFZhcmlhdGlvblNlbGVjdERyb3Bkb3ducygpIHtcbiAgICAgICAgY29uc3QgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICBpZiAoJHRoaXMuZmluZCgnb3B0aW9uJykuc2l6ZSgpID09PSAyKSB7XG4gICAgICAgICAgJHRoaXMudmFsKCR0aGlzLmZpbmQoJ29wdGlvbicpLmVxKDEpLnZhbCgpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIC8vIEVuc3VyZSB0aGUgcmlndGggcHJvZHVjdCBpbWFnZSBpcyBkaXNwbGF5ZWQuXG4gICAgLy8gU29tZSBkZWxheSBzZWVtcyB0byBiZSBuZWVkZWQgdG8gcmVmcmVzaCB0aGUgcHJvZHVjdCBpbWFnZS5cbiAgICAvLyBXZSBjb3VsZG4ndCBmaW5kIGEgcHJvcGVyIGV2ZW50IHRvIGhvb2sgb24sIHNvIHdlIHVzZWQgYSB0aW1lb3V0LlxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgJHZhcmlhdGlvbnNGb3JtLnRyaWdnZXIoJ2NoZWNrX3ZhcmlhdGlvbnMnKTtcbiAgICB9LCAxMDApO1xuICB9KTtcblxuICAkKCcuc2luZ2xlX3ZhcmlhdGlvbl93cmFwJylcbiAgICAub24oJ3Nob3dfdmFyaWF0aW9uJywgKGV2ZW50LCB2YXJpYXRpb24pID0+IHtcbiAgICAgIC8vIFVwZGF0ZXMgZGlzY291bnQgdGFibGUgb24gcHJvZHVjdCB2YXJpYXRpb24gY2hhbmdlLlxuICAgICAgJCgnW2RhdGEtdmFyaWF0aW9uc10nKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICAkKCQoJ1tkYXRhLXZhcmlhdGlvbnNdJykpLmVhY2goZnVuY3Rpb24gdXBkYXRlRGlzY291bnRUYWJsZSgpIHtcbiAgICAgICAgaWYgKCQodGhpcykuZGF0YSgndmFyaWF0aW9ucycpLmluZGV4T2YodmFyaWF0aW9uLnZhcmlhdGlvbl9pZC50b1N0cmluZygpKSAhPT0gLTEpIHtcbiAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnNob3coKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSlcbiAgICAub24oJ2hpZGVfdmFyaWF0aW9uJywgKCkgPT4ge1xuICAgICAgLy8gSGlkZXMgYWxsIHZhcmlhdGlvbiBwcm9kdWN0IGRpc2NvdW50IHRhYmxlIG9uIHByb2R1Y3QgdmFyaWF0aW9uIGhpZGUuXG4gICAgICAkKCQoJ1tkYXRhLXZhcmlhdGlvbnNdJykpLmVhY2goZnVuY3Rpb24gaGlkZURpc2NvdW50VGFibGUoKSB7XG4gICAgICAgICQodGhpcykucGFyZW50KCkuaGlkZSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgJChkb2N1bWVudCkucmVhZHkoKCkgPT4ge1xuICAgIC8vIERpc2FibGUgY29weS9wYXN0ZSBhY3Rpb25zIG9uIGJpbGxpbmcgZW1haWwgZmllbGRzLlxuICAgIGlmIChzaG9wX3N0YW5kYXJkc19zZXR0aW5ncy5lbWFpbENvbmZpcm1hdGlvbkVtYWlsID09PSAneWVzJykge1xuICAgICAgJCgnI2JpbGxpbmdfZW1haWwsICNiaWxsaW5nX2VtYWlsX2NvbmZpcm1hdGlvbicpLm9uKCdjdXQgY29weSBwYXN0ZScsIChlKSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBNYXJrcyBlbWFpbCBjb25maXJtYXRpb24gZmllbGQgYXMgaW52YWxpZCBpZiBkb2VzIG5vdCBtYXRjaCBlbWFpbFxuICAgICAgLy8gZmllbGQgb24gZm9ybSBzdWJtaXQuXG4gICAgICAkKCdmb3JtLndvb2NvbW1lcmNlLWNoZWNrb3V0Jykub24oJ2lucHV0IHZhbGlkYXRlIGNoYW5nZScsICgpID0+IHtcbiAgICAgICAgaWYgKCQoJyNiaWxsaW5nX2VtYWlsJykudmFsKCkgIT09ICQoJyNiaWxsaW5nX2VtYWlsX2NvbmZpcm1hdGlvbicpLnZhbCgpKSB7XG4gICAgICAgICAgJCgnI2JpbGxpbmdfZW1haWxfY29uZmlybWF0aW9uX2ZpZWxkJykucmVtb3ZlQ2xhc3MoJ3dvb2NvbW1lcmNlLXZhbGlkYXRlZCcpLmFkZENsYXNzKCd3b29jb21tZXJjZS1pbnZhbGlkIHdvb2NvbW1lcmNlLWludmFsaWQtcmVxdWlyZWQtZmllbGQnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBEaXNhYmxlIGNoZWNrb3V0IGJ1dHRvbiBpZiB0aGVyZSBhcmUgYW55IFdvb0NvbW1lcmNlIGVycm9yIGRpc3BsYXllZC5cbiAgJChkb2N1bWVudCkub24oJ3JlYWR5IHVwZGF0ZWRfY2FydF90b3RhbHMnLCAoKSA9PiB7XG4gICAgaWYgKCQoJy53b29jb21tZXJjZS1lcnJvcicpLmxlbmd0aCkge1xuICAgICAgJCgnLmNoZWNrb3V0LWJ1dHRvbicpLnJlbW92ZUF0dHIoJ2hyZWYnKS5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICQoJy53Y3BwZWMtY2hlY2tvdXQtYnV0dG9ucycpLmhpZGUoKTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIFVzZWQgYW5kIGRlZmVjdGl2ZSBnb29kcyBjaGVja2JveCBhZ3JlZW1lbnQgcmVsYXRlZCBmdW5jdGlvbmFsaXR5LlxuICAkKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgY29uc3QgJHVzZWRHb29kc0NvbnNlbnRDaGVja2JveCA9ICQoJyN1c2VkLWdvb2RzLWNvbnNlbnQnKTtcbiAgICBjb25zdCAkdXNlZEdvb2RzQ29uc2VudENvbnRhaW5lciA9ICQoJy5wcm9kdWN0LWRlZmVjdHNfX2NoZWNrYm94LWNvbnRhaW5lcicpO1xuICAgIGlmICgkdXNlZEdvb2RzQ29uc2VudENoZWNrYm94Lmxlbmd0aCkge1xuICAgICAgJChkb2N1bWVudClcbiAgICAgICAgLm9uKCdzaG93X3ZhcmlhdGlvbicsICcuc2luZ2xlX3ZhcmlhdGlvbl93cmFwJywgKGV2ZW50LCB2YXJpYXRpb24pID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyh2YXJpYXRpb24pO1xuICAgICAgICAgIGNvbnN0IHVzZWRHb29kc0NvbnNlbnRBdHRyID0gdmFyaWF0aW9uLnVzZWRfZ29vZHNfY29uc2VudF9hdHRyaWJ1dGU7XG4gICAgICAgICAgJCgnLnByb2R1Y3QtZGVmZWN0c19fYXR0cmlidXRlJykudGV4dCh1c2VkR29vZHNDb25zZW50QXR0cik7XG4gICAgICAgICAgaWYgKHVzZWRHb29kc0NvbnNlbnRBdHRyKSB7XG4gICAgICAgICAgICAkdXNlZEdvb2RzQ29uc2VudENvbnRhaW5lci5zaG93KCk7XG4gICAgICAgICAgICAkdXNlZEdvb2RzQ29uc2VudENoZWNrYm94LnByb3AoJ3JlcXVpcmVkJywgJ3JlcXVpcmVkJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICR1c2VkR29vZHNDb25zZW50Q29udGFpbmVyLmhpZGUoKTtcbiAgICAgICAgICAgICR1c2VkR29vZHNDb25zZW50Q2hlY2tib3gucmVtb3ZlQXR0cigncmVxdWlyZWQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59KGpRdWVyeSkpO1xuIl0sImZpbGUiOiJtYWluLmpzIn0=
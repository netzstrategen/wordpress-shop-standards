/* global jQuery, shop_standards_settings */
(function pageLoad($) {
  // Toggles product filtering by term.
  $('body').on('click', '[data-url]', function (e) {
    var url = $(e.target).data('url') || $(e.target).closest('[data-url]').data('url');

    if (url) {
      document.location.href = url;
    }
  });
  /**
   * Prevents multiple order to be sent.
   *
   * If the page takes time to be loaded, the user could click multiple
   * times on the place order button and this would generate multiple orders.
   * To prevent this we stop form submit event propagation after the first click.
   */

  var placeOrderBtnInitialValue = $('#place_order').prop('value');
  $('#place_order').click(function disableSubmitOrder(e) {
    if ($(this).hasClass('disabled')) {
      e.preventDefault();
      return;
    }

    $('#place_order').prop('value', 'Ihre Bestellung wird jetzt verarbeitetâ€¦').addClass('disabled');
  });
  $(document.body).on('checkout_error', function () {
    $('#place_order').prop('value', placeOrderBtnInitialValue).removeClass('disabled');
  });
  var $variationsForm = $('.variations_form');
  var $variationsSelectDropdowns = $('.variations_form .variations select');
  var $variationSelectChanged = false;
  $variationsSelectDropdowns.change(function variationSelectDropdownChanged() {
    $variationSelectChanged = $(this);
  });
  $('.variations_form').on('woocommerce_variation_has_changed', function () {
    // Allow selecting the default empty value of an attributes dropdown
    // without modifying the value of the others.
    if ($variationSelectChanged && $variationSelectChanged.val() === '') {
      $variationSelectChanged.val('');
      $variationSelectChanged = false;
    } else {
      // If there is only one option left in any of current variation attributes
      // dropdowns, it should be auto-selected.
      $variationsSelectDropdowns.each(function setVariationSelectDropdowns() {
        var $this = $(this);

        if ($this.find('option').size() === 2) {
          $this.val($this.find('option').eq(1).val());
        }
      });
    } // Ensure the rigth product image is displayed.
    // Some delay seems to be needed to refresh the product image.
    // We couldn't find a proper event to hook on, so we used a timeout.


    setTimeout(function () {
      $variationsForm.trigger('check_variations');
    }, 100);
  });
  $('.single_variation_wrap').on('show_variation', function (event, variation) {
    // Updates discount table on product variation change.
    $('[data-variations]').parent().hide();
    $($('[data-variations]')).each(function updateDiscountTable() {
      if ($(this).data('variations').indexOf(variation.variation_id.toString()) !== -1) {
        $(this).parent().show();
      }
    });
  }).on('hide_variation', function () {
    // Hides all variation product discount table on product variation hide.
    $($('[data-variations]')).each(function hideDiscountTable() {
      $(this).parent().hide();
    });
  });
  $(document).ready(function () {
    // Disable copy/paste actions on billing email fields.
    if (shop_standards_settings.emailConfirmationEmail === 'yes') {
      $('#billing_email, #billing_email_confirmation').on('cut copy paste', function (e) {
        e.preventDefault();
      }); // Marks email confirmation field as invalid if does not match email
      // field on form submit.

      $('form.woocommerce-checkout').on('input validate change', function () {
        if ($('#billing_email').val() !== $('#billing_email_confirmation').val()) {
          $('#billing_email_confirmation_field').removeClass('woocommerce-validated').addClass('woocommerce-invalid woocommerce-invalid-required-field');
        }
      });
    }
  }); // Disable checkout button if there are any WooCommerce error displayed.

  $(document).on('ready updated_cart_totals', function () {
    if ($('.woocommerce-error').length) {
      $('.checkout-button').removeAttr('href').addClass('disabled');
      $('.wcppec-checkout-buttons').hide();
    }
  }); // Used and defective goods checkbox agreement related functionality.

  $('[data-checkbox-detail-expand]').click(function () {
    $('.checkbox-detail').toggleClass('expand');
    $('.checkbox-read-more').toggleClass('hide');
  });
  $(document).ready(function () {
    var $checkboxElem = $('.checkbox-container');
    $(document).on('show_variation', '.single_variation_wrap', function (event, variation) {
      var zustand = variation.attributes.attribute_pa_zustand;
      $checkboxElem.detach();
      var placeholder = $('.product_meta');

      if (zustand !== 'originalverpackte-neuware') {
        $checkboxElem.insertAfter(placeholder);
        $('.zustand').text(zustand);
      }
    });
  });
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicGFnZUxvYWQiLCIkIiwib24iLCJlIiwidXJsIiwidGFyZ2V0IiwiZGF0YSIsImNsb3Nlc3QiLCJkb2N1bWVudCIsImxvY2F0aW9uIiwiaHJlZiIsInBsYWNlT3JkZXJCdG5Jbml0aWFsVmFsdWUiLCJwcm9wIiwiY2xpY2siLCJkaXNhYmxlU3VibWl0T3JkZXIiLCJoYXNDbGFzcyIsInByZXZlbnREZWZhdWx0IiwiYWRkQ2xhc3MiLCJib2R5IiwicmVtb3ZlQ2xhc3MiLCIkdmFyaWF0aW9uc0Zvcm0iLCIkdmFyaWF0aW9uc1NlbGVjdERyb3Bkb3ducyIsIiR2YXJpYXRpb25TZWxlY3RDaGFuZ2VkIiwiY2hhbmdlIiwidmFyaWF0aW9uU2VsZWN0RHJvcGRvd25DaGFuZ2VkIiwidmFsIiwiZWFjaCIsInNldFZhcmlhdGlvblNlbGVjdERyb3Bkb3ducyIsIiR0aGlzIiwiZmluZCIsInNpemUiLCJlcSIsInNldFRpbWVvdXQiLCJ0cmlnZ2VyIiwiZXZlbnQiLCJ2YXJpYXRpb24iLCJwYXJlbnQiLCJoaWRlIiwidXBkYXRlRGlzY291bnRUYWJsZSIsImluZGV4T2YiLCJ2YXJpYXRpb25faWQiLCJ0b1N0cmluZyIsInNob3ciLCJoaWRlRGlzY291bnRUYWJsZSIsInJlYWR5Iiwic2hvcF9zdGFuZGFyZHNfc2V0dGluZ3MiLCJlbWFpbENvbmZpcm1hdGlvbkVtYWlsIiwibGVuZ3RoIiwicmVtb3ZlQXR0ciIsInRvZ2dsZUNsYXNzIiwiJGNoZWNrYm94RWxlbSIsInp1c3RhbmQiLCJhdHRyaWJ1dGVzIiwiYXR0cmlidXRlX3BhX3p1c3RhbmQiLCJkZXRhY2giLCJwbGFjZWhvbGRlciIsImluc2VydEFmdGVyIiwidGV4dCIsImpRdWVyeSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFFQyxVQUFTQSxRQUFULENBQWtCQyxDQUFsQixFQUFxQjtBQUNwQjtBQUNBQSxFQUFBQSxDQUFDLENBQUMsTUFBRCxDQUFELENBQ0dDLEVBREgsQ0FFSSxP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QSxJQUFBQSxDQUFDLENBQUNPLFFBQUQsQ0FBRCxDQUNHTixFQURILENBQ00sZ0JBRE4sRUFDd0Isd0JBRHhCLEVBQ2tELFVBQUNnQyxLQUFELEVBQVFDLFNBQVIsRUFBc0I7QUFDcEUsVUFBTWdCLE9BQU8sR0FBR2hCLFNBQVMsQ0FBQ2lCLFVBQVYsQ0FBcUJDLG9CQUFyQztBQUNBSCxNQUFBQSxhQUFhLENBQUNJLE1BQWQ7QUFDQSxVQUFNQyxXQUFXLEdBQUd0RCxDQUFDLENBQUMsZUFBRCxDQUFyQjs7QUFDQSxVQUFJa0QsT0FBTyxLQUFLLDJCQUFoQixFQUE2QztBQUMzQ0QsUUFBQUEsYUFBYSxDQUFDTSxXQUFkLENBQTBCRCxXQUExQjtBQUNBdEQsUUFBQUEsQ0FBQyxDQUFDLFVBQUQsQ0FBRCxDQUFjd0QsSUFBZCxDQUFtQk4sT0FBbkI7QUFDRDtBQUNGLEtBVEg7QUFVRCxHQVpEO0FBYUQsQ0EvSEEsRUErSENPLE1BL0hELENBQUQiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBnbG9iYWwgalF1ZXJ5LCBzaG9wX3N0YW5kYXJkc19zZXR0aW5ncyAqL1xuXG4oZnVuY3Rpb24gcGFnZUxvYWQoJCkge1xuICAvLyBUb2dnbGVzIHByb2R1Y3QgZmlsdGVyaW5nIGJ5IHRlcm0uXG4gICQoJ2JvZHknKVxuICAgIC5vbihcbiAgICAgICdjbGljaycsXG4gICAgICAnW2RhdGEtdXJsXScsXG4gICAgICAoZSkgPT4ge1xuICAgICAgICBjb25zdCB1cmwgPSAkKGUudGFyZ2V0KS5kYXRhKCd1cmwnKSB8fCAkKGUudGFyZ2V0KS5jbG9zZXN0KCdbZGF0YS11cmxdJykuZGF0YSgndXJsJyk7XG4gICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gdXJsO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICk7XG5cbiAgLyoqXG4gICAqIFByZXZlbnRzIG11bHRpcGxlIG9yZGVyIHRvIGJlIHNlbnQuXG4gICAqXG4gICAqIElmIHRoZSBwYWdlIHRha2VzIHRpbWUgdG8gYmUgbG9hZGVkLCB0aGUgdXNlciBjb3VsZCBjbGljayBtdWx0aXBsZVxuICAgKiB0aW1lcyBvbiB0aGUgcGxhY2Ugb3JkZXIgYnV0dG9uIGFuZCB0aGlzIHdvdWxkIGdlbmVyYXRlIG11bHRpcGxlIG9yZGVycy5cbiAgICogVG8gcHJldmVudCB0aGlzIHdlIHN0b3AgZm9ybSBzdWJtaXQgZXZlbnQgcHJvcGFnYXRpb24gYWZ0ZXIgdGhlIGZpcnN0IGNsaWNrLlxuICAgKi9cblxuICBjb25zdCBwbGFjZU9yZGVyQnRuSW5pdGlhbFZhbHVlID0gJCgnI3BsYWNlX29yZGVyJykucHJvcCgndmFsdWUnKTtcbiAgJCgnI3BsYWNlX29yZGVyJykuY2xpY2soZnVuY3Rpb24gZGlzYWJsZVN1Ym1pdE9yZGVyKGUpIHtcbiAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnZGlzYWJsZWQnKSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAkKCcjcGxhY2Vfb3JkZXInKS5wcm9wKCd2YWx1ZScsICdJaHJlIEJlc3RlbGx1bmcgd2lyZCBqZXR6dCB2ZXJhcmJlaXRldOKApicpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICB9KTtcbiAgJChkb2N1bWVudC5ib2R5KS5vbignY2hlY2tvdXRfZXJyb3InLCAoKSA9PiB7XG4gICAgJCgnI3BsYWNlX29yZGVyJykucHJvcCgndmFsdWUnLCBwbGFjZU9yZGVyQnRuSW5pdGlhbFZhbHVlKS5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcbiAgfSk7XG5cbiAgY29uc3QgJHZhcmlhdGlvbnNGb3JtID0gJCgnLnZhcmlhdGlvbnNfZm9ybScpO1xuICBjb25zdCAkdmFyaWF0aW9uc1NlbGVjdERyb3Bkb3ducyA9ICQoJy52YXJpYXRpb25zX2Zvcm0gLnZhcmlhdGlvbnMgc2VsZWN0Jyk7XG4gIGxldCAkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZCA9IGZhbHNlO1xuXG4gICR2YXJpYXRpb25zU2VsZWN0RHJvcGRvd25zLmNoYW5nZShmdW5jdGlvbiB2YXJpYXRpb25TZWxlY3REcm9wZG93bkNoYW5nZWQoKSB7XG4gICAgJHZhcmlhdGlvblNlbGVjdENoYW5nZWQgPSAkKHRoaXMpO1xuICB9KTtcblxuICAkKCcudmFyaWF0aW9uc19mb3JtJykub24oJ3dvb2NvbW1lcmNlX3ZhcmlhdGlvbl9oYXNfY2hhbmdlZCcsICgpID0+IHtcbiAgICAvLyBBbGxvdyBzZWxlY3RpbmcgdGhlIGRlZmF1bHQgZW1wdHkgdmFsdWUgb2YgYW4gYXR0cmlidXRlcyBkcm9wZG93blxuICAgIC8vIHdpdGhvdXQgbW9kaWZ5aW5nIHRoZSB2YWx1ZSBvZiB0aGUgb3RoZXJzLlxuICAgIGlmICgkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZCAmJiAkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZC52YWwoKSA9PT0gJycpIHtcbiAgICAgICR2YXJpYXRpb25TZWxlY3RDaGFuZ2VkLnZhbCgnJyk7XG4gICAgICAkdmFyaWF0aW9uU2VsZWN0Q2hhbmdlZCA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJZiB0aGVyZSBpcyBvbmx5IG9uZSBvcHRpb24gbGVmdCBpbiBhbnkgb2YgY3VycmVudCB2YXJpYXRpb24gYXR0cmlidXRlc1xuICAgICAgLy8gZHJvcGRvd25zLCBpdCBzaG91bGQgYmUgYXV0by1zZWxlY3RlZC5cbiAgICAgICR2YXJpYXRpb25zU2VsZWN0RHJvcGRvd25zLmVhY2goZnVuY3Rpb24gc2V0VmFyaWF0aW9uU2VsZWN0RHJvcGRvd25zKCkge1xuICAgICAgICBjb25zdCAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgIGlmICgkdGhpcy5maW5kKCdvcHRpb24nKS5zaXplKCkgPT09IDIpIHtcbiAgICAgICAgICAkdGhpcy52YWwoJHRoaXMuZmluZCgnb3B0aW9uJykuZXEoMSkudmFsKCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gRW5zdXJlIHRoZSByaWd0aCBwcm9kdWN0IGltYWdlIGlzIGRpc3BsYXllZC5cbiAgICAvLyBTb21lIGRlbGF5IHNlZW1zIHRvIGJlIG5lZWRlZCB0byByZWZyZXNoIHRoZSBwcm9kdWN0IGltYWdlLlxuICAgIC8vIFdlIGNvdWxkbid0IGZpbmQgYSBwcm9wZXIgZXZlbnQgdG8gaG9vayBvbiwgc28gd2UgdXNlZCBhIHRpbWVvdXQuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAkdmFyaWF0aW9uc0Zvcm0udHJpZ2dlcignY2hlY2tfdmFyaWF0aW9ucycpO1xuICAgIH0sIDEwMCk7XG4gIH0pO1xuXG4gICQoJy5zaW5nbGVfdmFyaWF0aW9uX3dyYXAnKVxuICAgIC5vbignc2hvd192YXJpYXRpb24nLCAoZXZlbnQsIHZhcmlhdGlvbikgPT4ge1xuICAgICAgLy8gVXBkYXRlcyBkaXNjb3VudCB0YWJsZSBvbiBwcm9kdWN0IHZhcmlhdGlvbiBjaGFuZ2UuXG4gICAgICAkKCdbZGF0YS12YXJpYXRpb25zXScpLnBhcmVudCgpLmhpZGUoKTtcbiAgICAgICQoJCgnW2RhdGEtdmFyaWF0aW9uc10nKSkuZWFjaChmdW5jdGlvbiB1cGRhdGVEaXNjb3VudFRhYmxlKCkge1xuICAgICAgICBpZiAoJCh0aGlzKS5kYXRhKCd2YXJpYXRpb25zJykuaW5kZXhPZih2YXJpYXRpb24udmFyaWF0aW9uX2lkLnRvU3RyaW5nKCkpICE9PSAtMSkge1xuICAgICAgICAgICQodGhpcykucGFyZW50KCkuc2hvdygpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KVxuICAgIC5vbignaGlkZV92YXJpYXRpb24nLCAoKSA9PiB7XG4gICAgICAvLyBIaWRlcyBhbGwgdmFyaWF0aW9uIHByb2R1Y3QgZGlzY291bnQgdGFibGUgb24gcHJvZHVjdCB2YXJpYXRpb24gaGlkZS5cbiAgICAgICQoJCgnW2RhdGEtdmFyaWF0aW9uc10nKSkuZWFjaChmdW5jdGlvbiBoaWRlRGlzY291bnRUYWJsZSgpIHtcbiAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAkKGRvY3VtZW50KS5yZWFkeSgoKSA9PiB7XG4gICAgLy8gRGlzYWJsZSBjb3B5L3Bhc3RlIGFjdGlvbnMgb24gYmlsbGluZyBlbWFpbCBmaWVsZHMuXG4gICAgaWYgKHNob3Bfc3RhbmRhcmRzX3NldHRpbmdzLmVtYWlsQ29uZmlybWF0aW9uRW1haWwgPT09ICd5ZXMnKSB7XG4gICAgICAkKCcjYmlsbGluZ19lbWFpbCwgI2JpbGxpbmdfZW1haWxfY29uZmlybWF0aW9uJykub24oJ2N1dCBjb3B5IHBhc3RlJywgKGUpID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIE1hcmtzIGVtYWlsIGNvbmZpcm1hdGlvbiBmaWVsZCBhcyBpbnZhbGlkIGlmIGRvZXMgbm90IG1hdGNoIGVtYWlsXG4gICAgICAvLyBmaWVsZCBvbiBmb3JtIHN1Ym1pdC5cbiAgICAgICQoJ2Zvcm0ud29vY29tbWVyY2UtY2hlY2tvdXQnKS5vbignaW5wdXQgdmFsaWRhdGUgY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICBpZiAoJCgnI2JpbGxpbmdfZW1haWwnKS52YWwoKSAhPT0gJCgnI2JpbGxpbmdfZW1haWxfY29uZmlybWF0aW9uJykudmFsKCkpIHtcbiAgICAgICAgICAkKCcjYmlsbGluZ19lbWFpbF9jb25maXJtYXRpb25fZmllbGQnKS5yZW1vdmVDbGFzcygnd29vY29tbWVyY2UtdmFsaWRhdGVkJykuYWRkQ2xhc3MoJ3dvb2NvbW1lcmNlLWludmFsaWQgd29vY29tbWVyY2UtaW52YWxpZC1yZXF1aXJlZC1maWVsZCcpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIERpc2FibGUgY2hlY2tvdXQgYnV0dG9uIGlmIHRoZXJlIGFyZSBhbnkgV29vQ29tbWVyY2UgZXJyb3IgZGlzcGxheWVkLlxuICAkKGRvY3VtZW50KS5vbigncmVhZHkgdXBkYXRlZF9jYXJ0X3RvdGFscycsICgpID0+IHtcbiAgICBpZiAoJCgnLndvb2NvbW1lcmNlLWVycm9yJykubGVuZ3RoKSB7XG4gICAgICAkKCcuY2hlY2tvdXQtYnV0dG9uJykucmVtb3ZlQXR0cignaHJlZicpLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgJCgnLndjcHBlYy1jaGVja291dC1idXR0b25zJykuaGlkZSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gVXNlZCBhbmQgZGVmZWN0aXZlIGdvb2RzIGNoZWNrYm94IGFncmVlbWVudCByZWxhdGVkIGZ1bmN0aW9uYWxpdHkuXG4gICQoJ1tkYXRhLWNoZWNrYm94LWRldGFpbC1leHBhbmRdJykuY2xpY2soKCkgPT4ge1xuICAgICQoJy5jaGVja2JveC1kZXRhaWwnKS50b2dnbGVDbGFzcygnZXhwYW5kJyk7XG4gICAgJCgnLmNoZWNrYm94LXJlYWQtbW9yZScpLnRvZ2dsZUNsYXNzKCdoaWRlJyk7XG4gIH0pO1xuXG4gICQoZG9jdW1lbnQpLnJlYWR5KCgpID0+IHtcbiAgICBjb25zdCAkY2hlY2tib3hFbGVtID0gJCgnLmNoZWNrYm94LWNvbnRhaW5lcicpO1xuICAgICQoZG9jdW1lbnQpXG4gICAgICAub24oJ3Nob3dfdmFyaWF0aW9uJywgJy5zaW5nbGVfdmFyaWF0aW9uX3dyYXAnLCAoZXZlbnQsIHZhcmlhdGlvbikgPT4ge1xuICAgICAgICBjb25zdCB6dXN0YW5kID0gdmFyaWF0aW9uLmF0dHJpYnV0ZXMuYXR0cmlidXRlX3BhX3p1c3RhbmQ7XG4gICAgICAgICRjaGVja2JveEVsZW0uZGV0YWNoKCk7XG4gICAgICAgIGNvbnN0IHBsYWNlaG9sZGVyID0gJCgnLnByb2R1Y3RfbWV0YScpO1xuICAgICAgICBpZiAoenVzdGFuZCAhPT0gJ29yaWdpbmFsdmVycGFja3RlLW5ldXdhcmUnKSB7XG4gICAgICAgICAgJGNoZWNrYm94RWxlbS5pbnNlcnRBZnRlcihwbGFjZWhvbGRlcik7XG4gICAgICAgICAgJCgnLnp1c3RhbmQnKS50ZXh0KHp1c3RhbmQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfSk7XG59KGpRdWVyeSkpO1xuIl0sImZpbGUiOiJtYWluLmpzIn0=